"use strict";angular.module("app.core",[]),angular.module("app",["ngRoute","ui.router","ngSanitize","ngCookies","app.core"]).config(["$stateProvider","$httpProvider","$locationProvider",function($stateProvider,$httpProvider,$locationProvider){$stateProvider.state("home",{url:"/",templateUrl:"/js/views/controllers/home.html",controller:"HomeController",controllerAs:"vm"}).state("home.register",{url:"register",templateUrl:"/js/views/controllers/register.html",controller:"RegisterController",controllerAs:"vm"}).state("home.login",{url:"login",templateUrl:"/js/views/controllers/login.html",controller:"LoginController",controllerAs:"vm"}).state("home.logout",{url:"logout",templateUrl:"/js/views/controllers/logout.html",controller:"LogoutController",controllerAs:"vm"}).state("home.list",{url:"list",templateUrl:"/js/views/controllers/list.html",controller:"ListController",controllerAs:"vm"}).state("home.listVerses",{url:"list/:listId/verses",templateUrl:"/js/views/controllers/list-verses.html",controller:"ListVersesController",controllerAs:"vm"}).state("home.book",{url:"books/:bookId/:chapterId?verseId",templateUrl:"/js/views/controllers/book.html",controller:"BookController",controllerAs:"vm"}).state("home.bookWithTranslation",{url:":translation/books/:bookId/:chapterId?verseId",templateUrl:"/js/views/controllers/book.html",controller:"BookController",controllerAs:"vm"}).state("home.search",{url:"search/?query",templateUrl:"/js/views/controllers/search.html",controller:"SearchController",controllerAs:"vm"}),$locationProvider.html5Mode(!0)}]);var coreAppEnv={};window&&(coreAppEnv=angular.extend(coreAppEnv,window.__coreAppEnv)),angular.module("app.core").value("URL",coreAppEnv.URL).value("API_URL",coreAppEnv.API_URL).value("APP_API_URL",coreAppEnv.APP_API_URL).value("DEFAULT_TRANSLATION",coreAppEnv.DEFAULT_TRANSLATION),function(){function BookController($scope,$transitions,$state,$stateParams,ApiService,ModalStateService,TranslationStateService,BookSelectorStateService,TitleStateService){function init(){vm.book={},ApiService.getText(bookId,chapterId,TranslationStateService.getCurrent()).then(function(data){vm.versesLeft=[],vm.versesRight=[],vm.book=data[0].book;var testament="OT"==vm.book.testament?"Old Testament":"New Testament";TitleStateService.change("<b>"+vm.book.name+'</b><span class="hide-xs"> - <i>'+testament+"</i></span>");for(var i=0;i<data.length;i++)null!==verseId&&data[i].verseId==verseId&&(data[i].highlight=!0),i<data.length/2?vm.versesLeft.push(data[i]):vm.versesRight.push(data[i])}).then(function(){null!=verseId&&setTimeout(function(){var elem=document.getElementById("verse"+verseId);elem.scrollIntoView(),window.scroll(window.scrollX,window.scrollY-75)},250)})}function onStartTransition(){TranslationStateService.onChange("book",null)}function onKeyDownEvent(e){27===e.keyCode&&(ModalStateService.close(),$scope.$apply()),39===e.keyCode&&BookSelectorStateService.publish("next"),37===e.keyCode&&BookSelectorStateService.publish("previous")}function open(placement,verse){var element=document.getElementById("crossReferenceModal");element.style.left=null,element.style.left=null,"left"===placement?element.style.left=0:element.style.right=0;for(var verses=vm.versesLeft.concat(vm.versesRight),i=0;i<verses.length;i++)if(verses[i].hasOwnProperty("highlight")){verses[i].highlight=!1;break}ModalStateService.open(verse)}var vm=this;vm.book={},vm.versesLeft=[],vm.versesRight=[],vm.open=open;var bookId=1,chapterId=1,verseId=null;$stateParams.hasOwnProperty("bookId")&&(bookId=$stateParams.bookId),$stateParams.hasOwnProperty("chapterId")&&(chapterId=$stateParams.chapterId),$stateParams.hasOwnProperty("verseId")&&(verseId=$stateParams.verseId),$transitions.onStart({},onStartTransition),TranslationStateService.onChange("book",function(){init()}),init(),document.body.onkeydown=onKeyDownEvent}angular.module("app.core").controller("BookController",BookController),BookController.$inject=["$scope","$transitions","$state","$stateParams","ApiService","ModalStateService","TranslationStateService","BookSelectorStateService","TitleStateService"]}(),function(){function HomeController($state,$cookies,AppService,$transitions,SearchStateService,ModalStateService,TitleStateService){function onSuccessTransition(transition){"home.book"==transition.to().name&&ModalStateService.onOpen(closeNavigation),vm.loggedIn=$cookies.get("token")}function onTitleChange(value){vm.title=value}function onSearchResults(){isMobile()&&closeNavigation()}function closeNavigation(){vm.navIsOpen=!1,enableMobileScrolling()}function onToggleLeftNav(){vm.navIsOpen=!vm.navIsOpen,vm.navIsOpen?disableMobileScrolling():enableMobileScrolling()}function isMobile(){return window.innerWidth<=635}function enableMobileScrolling(){if(isMobile()){var elem=document.querySelector("body");elem.style.overflow="initial"}}function disableMobileScrolling(){if(isMobile()){var elem=document.querySelector("body");elem.style.overflow="hidden"}}var vm=this;vm.navIsOpen=!1,vm.title="Loading...",vm.onToggleLeftNav=onToggleLeftNav,vm.loggedIn=$cookies.get("token"),SearchStateService.onReady(onSearchResults),TitleStateService.onChange(onTitleChange),ModalStateService.onOpen(closeNavigation),$transitions.onSuccess({},onSuccessTransition),isMobile()||(vm.navIsOpen=!0),"home"===$state.$current.name&&$state.go("home.book",{bookId:1,chapterId:1},{reload:!0})}angular.module("app.core").controller("HomeController",HomeController),HomeController.$inject=["$state","$cookies","AppService","$transitions","SearchStateService","ModalStateService","TitleStateService"]}(),function(){function ListController(AppService,TitleStateService,$state,$scope){function showAddForm(){clearSelectedLists(),vm.toggleAddForm=!vm.toggleAddForm,vm.toggleUpdateForm=!1,vm.toggleDeleteForm=!1,vm.error=!1,vm.list={name:""}}function showUpdateForm(list){clearSelectedLists(),list.selected=!0,vm.toggleAddForm=!1,vm.toggleUpdateForm=!0,vm.toggleDeleteForm=!1,vm.error=!1,vm.list=angular.copy(list)}function showDeleteForm(list){clearSelectedLists(),list.selected=!0,vm.toggleAddForm=!1,vm.toggleUpdateForm=!1,vm.toggleDeleteForm=!0,vm.error=!1,vm.list=angular.copy(list)}function add(list){vm.error=!1,vm.isLoading=!0,AppService.addList(list).then(onSave)["catch"](onError)["finally"](stopLoading)}function update(list){vm.error=!1,vm.isLoading=!0,AppService.updateList(list.id,list).then(onSave)["catch"](onError).then(function(){list.selected=!1,vm.toggleUpdateForm=!1})["finally"](stopLoading)}function remove(list){vm.isLoading=!0,AppService.removeList(list.id).then(function(){vm.toggleDeleteForm=!1,vm.error=!1}).then(load)["finally"](stopLoading)}function load(){AppService.list().then(function(data){for(var i=0;i<data.length;i++)data[i].dateAdded=new Date(data[i].dateAdded),data[i].dateUpdated=new Date(data[i].dateUpdated);vm.lists=data})}function stopLoading(){vm.isLoading=!1}function onSave(){load(),vm.list={name:""},vm.error=!1}function onError(error){vm.error=error.data}function onKeyPress(event){var keyCode=event.which||event.keyCode;13===keyCode&&(vm.toggleAddForm&&add(vm.list),vm.toggleUpdateForm&&update(vm.list))}function clearSelectedLists(){for(var i=0;i<vm.lists.length;i++)vm.lists[i].selected=!1}function checkAuthorization(){return AppService.me()["catch"](function(){$state.go("home.login")})}var vm=this;vm.isLoading=!1,vm.error=!1,vm.toggleAddForm=!1,vm.toggleUpdateForm=!1,vm.toggleDeleteForm=!1,vm.lists=[],vm.list={name:""},vm.add=add,vm.update=update,vm.remove=remove,vm.onKeyPress=onKeyPress,vm.showAddForm=showAddForm,vm.showUpdateForm=showUpdateForm,vm.showDeleteForm=showDeleteForm,TitleStateService.change("<b>Manage Lists</b>"),checkAuthorization().then(load)}angular.module("app.core").controller("ListController",ListController),ListController.$inject=["AppService","TitleStateService","$state","$scope"]}(),function(){function ListVersesController(AppService,$stateParams,TitleStateService,$state,$scope){function showAddVerseForm(){vm.error=!1,vm.toggleAddForm=!vm.toggleAddForm,vm.toggleDeleteForm=!1}function showDeleteForm(verse){vm.error=!1,verse.selected=!0,vm.toggleAddForm=!1,vm.toggleDeleteForm=!0,vm.verse=angular.copy(verse)}function remove(verse){vm.isLoading=!0,AppService.removeVerseFromList(vm.listId,verse.text.id,verse.translation).then(function(){vm.verse={},vm.toggleDeleteForm=!1}).then(load)["finally"](stopLoading)}function load(){return AppService.listById(vm.listId).then(function(data){vm.list=data,AppService.getVersesFromList(vm.listId).then(function(verses){vm.verses=verses})})["catch"](function(){$state.go("home.lists")})}function stopLoading(){vm.isLoading=!1}function checkAuthorization(){return AppService.me()["catch"](function(){$state.go("home.login")})}var vm=this;vm.isLoading=!1,vm.error=!1,vm.listId=$stateParams.listId,vm.list={name:""},vm.verses=[],vm.verse={},vm.toggleAddForm=!1,vm.toggleDeleteForm=!1,vm.showAddVerseForm=showAddVerseForm,vm.showDeleteForm=showDeleteForm,vm.remove=remove,TitleStateService.change('<b>Manage Lists</b><span class="hide-xs"> - <i>Add Verses</i></span>'),checkAuthorization().then(load),$scope.$on("verse.added",function(){load()})}angular.module("app.core").controller("ListVersesController",ListVersesController),ListVersesController.$inject=["AppService","$stateParams","TitleStateService","$state","$scope"]}(),function(){function LoginController(AppService,$cookies,$state,TitleStateService){function login(){vm.error=!1,AppService.login(vm.email,vm.password).then(onLogin)["catch"](onLoginError)}function onLogin(){$state.go("home.list")}function onLoginError(error){vm.error=error.data}function onKeyPress(event){var keyCode=event.which||event.keyCode;13===keyCode&&login()}var vm=this;vm.error=!1,vm.email="",vm.password="",vm.onKeyPress=onKeyPress,vm.login=login,TitleStateService.change("Login")}angular.module("app.core").controller("LoginController",LoginController),LoginController.$inject=["AppService","$cookies","$state","TitleStateService"]}(),function(){function LogoutController(AppService,$cookies,TitleStateService,$state){TitleStateService.change("Logout"),AppService.logout()["finally"](function(){$cookies.remove("token"),$state.go("home.login")})}angular.module("app.core").controller("LogoutController",LogoutController),LogoutController.$inject=["AppService","$cookies","TitleStateService","$state"]}(),function(){function RegisterController(AppService,$state,TitleStateService){function register(){vm.error=!1,AppService.register(vm.email,vm.password,vm.passwordConf).then(onRegister)["catch"](onRegisterError)}function onRegisterError(error){vm.error=error.data}function onRegister(){AppService.login(vm.email,vm.password).then(onLogin)}function onLogin(){$state.go("home.list")}function onKeyPress(event){var keyCode=event.which||event.keyCode;13===keyCode&&register()}var vm=this;vm.error=!1,vm.email="",vm.password="",vm.passwordConf="",vm.onKeyPress=onKeyPress,vm.register=register,TitleStateService.change("Register")}angular.module("app.core").controller("RegisterController",RegisterController),RegisterController.$inject=["AppService","$state","TitleStateService"]}(),function(){function SearchController($scope,$transitions,$state,$stateParams,ApiService,TranslationStateService,SearchStateService,TitleStateService,$filter){function onStartTransition(){TranslationStateService.onChange("search",null)}function doSearch(){TitleStateService.change("Searching..."),vm.isLoading=!0,vm.isLoadingCounts=!0,ApiService.search(vm.query,translation,offset,limit).then(onSearch),ApiService.searchAggregation(vm.query,translation).then(onSearchAggregation)}function loadMore(){vm.isLoading=!0,offset+=limit,ApiService.search(vm.query,translation,offset,limit).then(onLoadMore)}function onSearch(result){window.scrollTo(0,0),offset=0,vm.result=result,vm.isLoading=!1;var append="";1e4===vm.result.total&&(append="+"),TitleStateService.change("<b>Found "+$filter("number")(vm.result.total)+append+' Results</b><span class="hide-xs"> - <i>In '+translation+"</i></span>"),SearchStateService.ready()}function onSearchAggregation(result){null==chart&&initChart(),vm.otHits=0,vm.ntHits=0;for(var i=0;i<result.length;i++)i>=39?vm.ntHits+=result[i].hits:vm.otHits+=result[i].hits,chart.data.labels[i]=result[i].book.name,chart.data.datasets[0].data[i]=result[i].hits;vm.isLoadingCounts=!1,setTimeout(function(){chart.update()},250)}function onLoadMore(result){vm.result.items=vm.result.items.concat(result.items),vm.isLoading=!1}function initChart(){for(var ctx=document.getElementById("graph"),labels=[],data=[],backgroundColors=[],borderColors=[],bg="rgba(81, 81, 81, 0.2)",border="rgba(81, 81, 81, 0.5)",i=0;i<=66;i++)i>=39&&(bg="rgba(152, 140, 81, 0.5)",border="rgba(152, 140, 81, 1)"),backgroundColors[i]=bg,borderColors[i]=border;chart=new Chart(ctx,{type:"bar",data:{labels:labels,datasets:[{label:"Instances Found",data:data,backgroundColor:backgroundColors,borderColor:borderColors,borderWidth:1,minBarLength:5}]},options:{maintainAspectRatio:!1,legend:{display:!1},tooltips:{displayColors:!1,xPadding:15,yPadding:15,backgroundColor:"rgba(108, 117, 125, 1)",callbacks:{title:function(tooltipItem){console.log(tooltipItem);var testament=tooltipItem[0].index<39?"Old Testament":"New Testament";return tooltipItem[0].label+" - "+testament},label:function(tooltipItem){return $filter("number")(tooltipItem.yLabel)+" Results"}}},scales:{xAxes:[{gridLines:{display:!1},ticks:{display:!1}}],yAxes:[{ticks:{beginAtZero:!0}}]}}})}var vm=this;vm.query=$stateParams.query,vm.isLoading=!0,vm.isLoadingCounts=!0,vm.otHits=0,vm.ntHits=0,vm.result={total:0,items:[]},vm.loadMore=loadMore;var translation=TranslationStateService.getCurrent(),limit=100,offset=0,chart=null;doSearch(),TranslationStateService.onChange("search",function(obj){translation=obj.abbreviation,doSearch()}),$transitions.onStart({},onStartTransition)}angular.module("app.core").controller("SearchController",SearchController),SearchController.$inject=["$scope","$transitions","$state","$stateParams","ApiService","TranslationStateService","SearchStateService","TitleStateService","$filter"]}(),function(){function addVerseForm(){return{restrict:"E",scope:{},controller:ctrl,controllerAs:"vm",bindToController:!0,templateUrl:"/js/views/directives/add-verse-form.html"}}function ctrl($scope,$stateParams,AppService,ApiService,$q,TranslationStateService,$transitions){function save(){vm.error=!1,vm.selected.verse.realId&&(vm.isLoading=!0,AppService.addVerseToList(vm.listId,vm.selected.verse.realId,TranslationStateService.getCurrent()).then(onSave)["catch"](onError)["finally"](stopLoading))}function onSave(){$scope.$emit("verse.added")}function onTranslationChange(){null!=vm.selected.chapter.id&&onSelectChapter(vm.selected.chapter)}function getBooks(){return vm.isLoading=!0,ApiService.getBooks().then(function(books){return vm.books=books,vm.selected.book=vm.books[0],vm.selected.book.id}).then(ApiService.getChaptersFromBook).then(function(chapters){vm.chapters=chapters,vm.selected.chapter=vm.chapters[0],onSelectChapter(chapters[0])})["finally"](function(){vm.isLoading=!1})}function onSelectBook(book){vm.isLoading=!0,ApiService.getChaptersFromBook(book.id).then(function(chapters){vm.chapters=chapters,vm.selected.chapter=vm.chapters[0],onSelectChapter(chapters[0])})["finally"](function(){vm.isLoading=!1})}function onSelectChapter(chapter){vm.verses=[],ApiService.getText(vm.selected.book.id,chapter.id,TranslationStateService.getCurrent()).then(function(text){for(var i=0;i<text.length;i++)vm.verses.push({realId:text[i].id,id:text[i].verseId,verse:text[i].verse});vm.selected.verse=vm.verses[0]})}function onError(error){vm.error=error.data}function stopLoading(){vm.isLoading=!1}var vm=this;vm.listId=$stateParams.listId,vm.error=!1,vm.books=[],vm.selected={book:{id:null},chapter:{id:null},verse:{id:null}},vm.isLoading=!0,vm.save=save,vm.onSelectBook=onSelectBook,vm.onSelectChapter=onSelectChapter,getBooks(),TranslationStateService.onChange("addVerseForm",onTranslationChange),$transitions.onStart({},function(){TranslationStateService.unsubscribe("addVerseForm")})}angular.module("app.core").directive("addVerseForm",addVerseForm),ctrl.$inject=["$scope","$stateParams","AppService","ApiService","$q","TranslationStateService","$transitions"]}(),function(){function bookSelector(){return{restrict:"E",scope:{},controller:ctrl,controllerAs:"vm",bindToController:!0,templateUrl:"/js/views/directives/book-selector.html"}}function ctrl($scope,ApiService,$q,$state,$stateParams,BookSelectorStateService){function getBooks(){return ApiService.getBooks().then(function(books){for(var i=0;i<books.length;i++)books[i].testament="OT"===books[i].testament?"Old Testament":"New Testament";return vm.books=books,setSelectedBook(stateBookId),stateBookId}).then(ApiService.getChaptersFromBook).then(function(chapters){vm.chapters=chapters,setSelectedChapter(stateChapterId)})["finally"](function(){vm.isLoading=!1})}function onSelectBook(book){setSelectedChapter(1),ApiService.getChaptersFromBook(book.id).then(function(chapters){vm.chapters=chapters}),checkBtnState(book.id,1),$state.go("home.book",{bookId:book.id,chapterId:1,verseId:null})}function onSelectChapter(chapter){checkBtnState(vm.selected.book.id,chapter.id),$state.go("home.book",{bookId:vm.selected.book.id,chapterId:chapter.id,verseId:null})}function onPreviousClick(){var bookId=vm.selected.book.id,chapterId=vm.selected.chapter.id;chapterId-1===0?(bookId--,vm.isLoading=!0,ApiService.getChaptersFromBook(bookId).then(function(chapters){vm.chapters=chapters,vm.isLoading=!1,setSelectedBook(bookId),setSelectedChapter(chapters.length),checkBtnState(bookId,chapters.length),$state.go("home.book",{bookId:bookId,chapterId:chapters.length,verseId:null})})):(chapterId--,setSelectedChapter(chapterId),checkBtnState(bookId,chapterId),$state.go("home.book",{bookId:bookId,chapterId:chapterId,verseId:null}))}function onNextClick(){var maxChapters=vm.chapters.length,bookId=vm.selected.book.id,chapterId=vm.selected.chapter.id;chapterId+1>maxChapters?(bookId++,chapterId=1,$scope.isLoading=!0,ApiService.getChaptersFromBook(bookId).then(function(chapters){vm.chapters=chapters,$scope.isLoading=!1})):chapterId++,setSelectedBook(bookId),setSelectedChapter(chapterId),checkBtnState(bookId,chapterId),$state.go("home.book",{bookId:bookId,chapterId:chapterId,verseId:null})}function setSelectedBook(bookId){for(var index in vm.books)if(vm.books[index].id===bookId){vm.selected.book=vm.books[index];break}null==vm.selected.book.id&&(vm.selected.book=vm.books[0])}function setSelectedChapter(chapterId){for(var index in vm.chapters)if(vm.chapters[index].id===chapterId){vm.selected.chapter=vm.chapters[index];break}null==vm.selected.chapter.id&&(vm.selected.chapter=vm.chapters[0])}function checkBtnState(bookId,chapterId){vm.disablePreviousBtn=1===bookId&&1===chapterId,vm.disableNextBtn=66===bookId&&22===chapterId}var vm=this;vm.books=[],vm.selected={book:{id:null},chapter:{id:null}},vm.disablePreviousBtn=!1,vm.disableNextBtn=!1,vm.isLoading=!0,vm.onSelectBook=onSelectBook,vm.onSelectChapter=onSelectChapter,vm.onPreviousClick=onPreviousClick,vm.onNextClick=onNextClick;var stateBookId=parseInt($stateParams.bookId),stateChapterId=parseInt($stateParams.chapterId);stateBookId||(stateBookId=1),stateChapterId||(stateChapterId=1),checkBtnState(stateBookId,stateChapterId),getBooks(),BookSelectorStateService.subscribe("next",function(){return!vm.disableNextBtn&&void vm.onNextClick()}),BookSelectorStateService.subscribe("previous",function(){return!vm.disablePreviousBtn&&void vm.onPreviousClick()})}angular.module("app.core").directive("bookSelector",bookSelector),ctrl.$inject=["$scope","ApiService","$q","$state","$stateParams","BookSelectorStateService"]}(),function(){function crossReferenceModal(){return{restrict:"E",scope:{},controller:ctrl,controllerAs:"vm",bindToController:!0,templateUrl:"/js/views/directives/cross-reference-modal.html"}}function ctrl($scope,$transitions,ApiService,ModalStateService,TranslationStateService){function init(){ApiService.getCrossReferences(currentVerse.id,TranslationStateService.getCurrent()).then(function(data){vm.relatedVerses=data,vm.isLoading=!1,document.getElementById("crossReferenceModal").scrollTop=0})}function onStartTransition(){TranslationStateService.onChange("crossRef",null),ModalStateService.clear()}function close(){vm.isOpen=!1}var vm=this;vm.verse={},vm.relatedVerses=[],vm.isOpen=!1,vm.close=close;var currentVerse=null;TranslationStateService.onChange("crossRef",function(){return!!vm.isOpen&&void init()}),$transitions.onStart({},onStartTransition),ModalStateService.onOpen(function(verse){null!==currentVerse&&(currentVerse.highlight=!1),currentVerse=verse,currentVerse.highlight=!0,vm.isOpen=!0,vm.isLoading=!0,init()}),ModalStateService.onClose(function(){vm.isOpen=!1})}angular.module("app.core").directive("crossReferenceModal",crossReferenceModal),ctrl.$inject=["$scope","$transitions","ApiService","ModalStateService","TranslationStateService"]}(),function(){function searchInput(){return{restrict:"E",scope:{},controller:ctrl,controllerAs:"vm",bindToController:!0,templateUrl:"/js/views/directives/search-input.html"}}function ctrl($transitions,$state,$stateParams,SearchStateService){function init(){$transitions.onStart({},onStartTransition),SearchStateService.onReady(onReady)}function onKeyPress(event){var keyCode=event.which||event.keyCode;13===keyCode&&onSearch(vm.searchQuery)}function onStartTransition(transition){vm.isLoading=!0,"home.search"!==transition.to().name&&(vm.isLoading=!1)}function onReady(){vm.isLoading=!1}function onSearch(searchQuery){$state.go("home.search",{query:searchQuery})}var vm=this;vm.searchQuery="",vm.onSearch=onSearch,vm.onKeyPress=onKeyPress,vm.isLoading=!1,$stateParams.query&&(vm.searchQuery=$stateParams.query),init()}angular.module("app.core").directive("searchInput",searchInput),ctrl.$inject=["$transitions","$state","$stateParams","SearchStateService"]}(),function(){function translationSelector(){return{restrict:"E",scope:{},controller:ctrl,controllerAs:"vm",bindToController:!0,templateUrl:"/js/views/directives/translation-selector.html"}}function ctrl($scope,ApiService,$q,TranslationStateService){function getTranslations(){return ApiService.getTranslations().then(function(translations){for(var i=0;i<translations.length;i++)translations[i].name=translations[i].abbreviation,TranslationStateService.getCurrent().toLowerCase()==translations[i].abbreviation.toLowerCase()&&(vm.selected.translation=translations[i]);vm.translations=translations,vm.isLoading=!1})}function onSelectTranslation(translation){vm.selected.translation=translation,TranslationStateService.change(translation)}var vm=this;vm.translations=[],vm.selected={translation:null},vm.isLoading=!0,vm.onSelectTranslation=onSelectTranslation,getTranslations()}angular.module("app.core").directive("translationSelector",translationSelector),ctrl.$inject=["$scope","ApiService","$q","TranslationStateService"]}(),function(){function ApiService($http,API_URL,$q){function getTranslations(){return _get("/translations")}function getCrossReferences(verseId,translation){return _get("/verse/"+verseId+"/relations",{params:{translation:translation}})}function getBooks(){return _get("/books")}function getChaptersFromBook(bookId){return _get("/books/"+bookId+"/chapters")}function getMaxChapterFromBook(bookId){var deferred=$q.defer();return _get("/books/"+bookId+"/chapters").then(function(data){deferred.resolve(data[data.length-1].id)})["catch"](function(){deferred.reject()}),deferred.promise}function getText(bookId,chapterId,translation){return _get("/books/"+bookId+"/chapters/"+chapterId,{params:{translation:translation}})}function search(query,translation,offset,limit){return _get("/search",{params:{query:query,translation:translation,offset:offset,limit:limit}})}function searchAggregation(query,translation){return _get("/searchAggregator",{params:{query:query,translation:translation}})}function _getHttpOptions(endpoint,options){var defaultOptions={},httpOptions={};return httpOptions="object"==typeof options?angular.extend(options,defaultOptions):defaultOptions}function _get(endpoint,options){var url=API_URL+endpoint,httpOptions=_getHttpOptions(endpoint,options);return $http.get(url,httpOptions).then(function(response){return response.data})}return{getTranslations:getTranslations,getCrossReferences:getCrossReferences,getBooks:getBooks,getChaptersFromBook:getChaptersFromBook,getMaxChapterFromBook:getMaxChapterFromBook,getText:getText,search:search,searchAggregation:searchAggregation}}angular.module("app.core").service("ApiService",ApiService),ApiService.$inject=["$http","API_URL","$q"]}(),function(){function AppService($http,APP_API_URL,$q){function getVersesFromList(listId){return _get("/lists/"+listId+"/verses",{withCredentials:!0})}function addVerseToList(listId,verseId,translation){return _put("/lists/"+listId+"/verses/"+verseId+"?translation="+translation,{},{withCredentials:!0})}function removeVerseFromList(listId,verseId,translation){return _delete("/lists/"+listId+"/verses/"+verseId+"?translation="+translation,{withCredentials:!0})}function login(email,password){return _post("/authenticate",{email:email,password:password},{withCredentials:!0})}function me(){return _get("/authenticate/me",{withCredentials:!0})}function logout(){return _get("/authenticate/logout",{withCredentials:!0})}function list(){return _get("/lists",{withCredentials:!0})}function listById(id){return _get("/lists/"+id,{withCredentials:!0})}function addList(list){return _post("/lists",list,{withCredentials:!0})}function updateList(id,list){return _put("/lists/"+id,list,{withCredentials:!0})}function removeList(id){return _delete("/lists/"+id,{withCredentials:!0})}function register(email,password,passwordConf){return _post("/register",{email:email,password:password,passwordConf:passwordConf})}function _getHttpOptions(endpoint,options){var defaultOptions={},httpOptions={};return httpOptions="object"==typeof options?angular.extend(options,defaultOptions):defaultOptions}function _post(endpoint,data,options){var url=APP_API_URL+endpoint,httpOptions=_getHttpOptions(endpoint,options);return $http.post(url,data,httpOptions).then(function(response){return response.data})}function _put(endpoint,data,options){var url=APP_API_URL+endpoint,httpOptions=_getHttpOptions(endpoint,options);return $http.put(url,data,httpOptions).then(function(response){return response.data})}function _get(endpoint,options){var url=APP_API_URL+endpoint,httpOptions=_getHttpOptions(endpoint,options);return $http.get(url,httpOptions).then(function(response){return response.data})}function _delete(endpoint,options){var url=APP_API_URL+endpoint,httpOptions=_getHttpOptions(endpoint,options);return $http["delete"](url,httpOptions).then(function(response){return response.data})}return{login:login,register:register,me:me,list:list,listById:listById,addList:addList,removeList:removeList,updateList:updateList,getVersesFromList:getVersesFromList,addVerseToList:addVerseToList,removeVerseFromList:removeVerseFromList,logout:logout}}angular.module("app.core").service("AppService",AppService),AppService.$inject=["$http","APP_API_URL","$q"]}(),function(){function BookSelectorStateService(){function subscribe(topic,fn){subscriptions[topic]=fn}function unsubscribe(topic){delete subscriptions[topic]}function publish(topic){subscriptions[topic]()}var subscriptions=[];return{subscribe:subscribe,unsubscribe:unsubscribe,publish:publish}}angular.module("app.core").service("BookSelectorStateService",BookSelectorStateService)}(),function(){function ModalStateService(){function clear(){openFns=[]}function open(verseId){if(0===openFns.length)return!1;for(var i=0;i<openFns.length;i++)openFns[i](verseId)}function close(){return null!=closeFn&&void closeFn()}function onOpen(callback){openFns.push(callback)}function onClose(callback){closeFn=callback}var openFns=[],closeFn=null;return{open:open,onOpen:onOpen,close:close,onClose:onClose,clear:clear}}angular.module("app.core").service("ModalStateService",ModalStateService)}(),function(){function SearchStateService(){function onReady(fn){subscriptionFns.push(fn)}function unsubscribe(){subscriptionFns=[]}function ready(){if(0!==subscriptionFns.length)for(var i=0;i<subscriptionFns.length;i++)subscriptionFns[i]()}var subscriptionFns=[];return{onReady:onReady,unsubscribe:unsubscribe,ready:ready}}angular.module("app.core").service("SearchStateService",SearchStateService)}(),function(){function TitleStateService(){function change(value){return null!=changeFn&&void changeFn(value)}function onChange(callback){changeFn=callback}var changeFn=null;return{change:change,onChange:onChange}}angular.module("app.core").service("TitleStateService",TitleStateService)}(),function(){function TranslationStateService($cookies,$stateParams,DEFAULT_TRANSLATION){function change(translation){$cookies.put("translation",translation.abbreviation);for(var key in changeFns)changeFns.hasOwnProperty(key)&&null!=changeFns[key]&&changeFns[key](translation)}function onChange(key,callback){changeFns[key]=callback}function getCurrent(){return $cookies.get("translation")}function unsubscribe(key){changeFns[key]=null,delete changeFns[key]}var changeFns={};return $stateParams.hasOwnProperty("translation")&&$cookies.put("translation",$stateParams.translation),"undefined"==typeof $cookies.get("translation")&&$cookies.put("translation",DEFAULT_TRANSLATION),{change:change,onChange:onChange,getCurrent:getCurrent,unsubscribe:unsubscribe}}angular.module("app.core").service("TranslationStateService",["$cookies","$stateParams","DEFAULT_TRANSLATION",TranslationStateService])}();